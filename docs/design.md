# 設計書

## 要件定義書

- **対象プラットフォーム**: Raspberry Pi Zero 2 W 上で動作する Python プログラム
- **マイコン書込み**: ATtiny1616 への書込みは pymcuprog を利用し、UPDI 経由で実施
- **ハードウェア構成**:
  - 赤色LED: GPIO17
  - 黄色LED: GPIO27
  - 緑色LED: GPIO22
  - ブザー: GPIO23
  - スイッチ1: GPIO24
  - スイッチ2: GPIO21 (hexファイル選択用)
  - LCDディスプレイ: I2C接続, アドレス0x3e, SDA=GPIO2, SCL=GPIO3
  - LCDバックライト: GPIO26

### 機能要件
1. プログラム起動時に緑色LEDを点灯
2. 待機状態でスイッチ2が押されるたびに `./hex` ディレクトリ内の `.hex` ファイルを選択し、LCDにファイル名を表示
3. スイッチ1が押されたら `./hex` ディレクトリ内の選択中の `.hex` ファイルを UPDI で書き込み
4. 書込み中は黄色LEDを点灯し続ける
5. 書込み完了後、ブザーを1秒間鳴動
6. ブザー鳴動後、再度緑色LED点灯の待機状態に戻る

## 概略設計

- メインループでスイッチ2によるhexファイル選択とスイッチ1による書込み操作をポーリング
- ステートマシンによって各状態（待機、書込み中、通知）を管理
- ファイル選択時にはLCDに選択中のファイル名を表示
- 書込み処理はサブプロセスで pymcuprog を呼び出し、終了ステータスを監視
- GPIO 制御には RPi.GPIO を利用

## クラス構成

- `class LED`:
  - コンストラクタで GPIO ピンを指定
  - `on()`, `off()` メソッドを提供

- `class Buzzer`:
  - コンストラクタで GPIO ピンを指定
  - `buzz(duration_sec)` メソッドを提供

- `class Button`:
  - コンストラクタで GPIO ピンを指定
  - `is_pressed()` メソッドを提供（簡易デバウンス実装）

- `class LCD`:
  - コンストラクタでI2Cアドレス、バックライトピンを指定
  - `display(text: str, line: int = 0)` メソッドで指定行に文字を表示
  - `backlight(on: bool)` メソッドでバックライトを点灯/消灯

- `class Programmer`:
  - `write_hex(file_path)` メソッドで pymcuprog をサブプロセス実行

- `main.py`:
  - 上記クラスを組み合わせ、ステートマシンを実装
  - 初期化時に緑色LEDを点灯
  - メインループでスイッチ1 押下を検知し、書込みから通知までを制御
